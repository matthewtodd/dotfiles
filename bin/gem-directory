#!/usr/bin/env ruby

require 'rubygems'

def show_path(spec)
  puts spec.full_gem_path
end

def prompt_to_select(specs)
  specs.each_with_index do |spec, index|
    $stderr.puts '%2d. %s' % [index.succ, spec.full_name]
  end

  $stderr.puts
  $stderr.write "[#{specs.last.full_name}] ? "
  $stderr.flush

  choice = begin
    gets.to_s.strip.to_i
  rescue Interrupt
    $stderr.puts
    $stderr.puts 'Goodbye.'
    exit
  end

  case choice
  when 0
    specs.last
  when (1..specs.length)
    specs[choice.pred]
  else
    prompt_to_select(specs)
  end
end

specs = Gem.source_index.find_name /^#{ARGV.shift}/

show_path case specs.length
          when 0
            prompt_to_select(Gem.source_index.gems)
          when 1
            specs.first
          else
            prompt_to_select(specs)
          end
