#!/usr/bin/env ruby

require 'pathname'

# Ganked and modified from http://github.com/elabs/dotfiles/bash/completion_scripts
class DirectoryCompletion
  def initialize(directory, command)
    @directory = Pathname.new(directory || ENV['HOME'])
    @command   = command
  end

  def matches
    projects.select do |task|
      task[0, typed.length] == typed
    end
  end

  def typed
    @command[/\s(.+?)$/, 1] || ''
  end

  def projects
    @directory.children.select { |c| c.directory? }.map { |c| c.basename.to_s }
  end
end

puts DirectoryCompletion.new(ARGV.shift, ENV["COMP_LINE"]).matches
exit 0

