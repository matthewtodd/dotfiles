#!/usr/bin/env ruby -wKU

# This construct discourages me from re-using a local "directory" variable.
class Dir
  def self.mkchdir(path)
    mkdir(path)
    chdir(path) do
      yield if block_given?
    end
  end
end

Dir.mkchdir(ARGV.shift) do
  File.open('Gemfile', 'w') do |f|
    f.puts "bundle_path 'vendor/bundle'"
    f.puts
    f.puts "gem 'rails', '2.3.5'"
  end

  File.open('.gitignore', 'w') do |f|
    f.puts 'bin'
    f.puts 'vendor/bundle'
  end

  system 'gem bundle'
  system 'git init'
  system 'git add Gemfile'
  system 'git add .gitignore'
  system 'git commit -m "Configure bundler."'
  system './bin/rails -m ~/.rails/template.rb .'
end
